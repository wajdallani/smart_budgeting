{% extends layout_path %}
{% comment %} {% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Mes dettes{% endblock %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/masonry/masonry.js' %}"></script>
{% endblock vendor_js %}


{% block content %}
  <h1>Dettes</h1>
  <a href="{% url 'detteApp:debt_add' %}">Ajouter une dette</a>
  <ul>
    {% for d in debts %}
      <li>
        <a href="{{ d.get_absolute_url }}">{{ d.title }}</a> — {{ d.remaining_amount }}
      </li>
    {% empty %}
      <li>Aucune dette.</li>
    {% endfor %}
  </ul>

{% endblock %} {% endcomment %}


{% load static %}
{% load i18n %}

{% block title %}Mes dettes{% endblock %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/masonry/masonry.js' %}"></script>
{% endblock vendor_js %}

{% block content %}
<div class="container py-5">

    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="fw-bold mb-1">Mes dettes</h1>
            <p class="text-muted">Suivez toutes vos dettes en un coup d'œil.</p>
        </div>

        <a href="{% url 'detteApp:debt_add' %}" class="btn btn-primary d-flex align-items-center">
            <i class="ti ti-plus me-1"></i> Ajouter une dette
        </a>
    </div>

    <!-- Debt Cards -->
    <div class="row g-4">
        {% for d in debts %}
            <div class="col-md-6 col-lg-4">
                <a href="{{ d.get_absolute_url }}" class="text-decoration-none">
                    <div class="card h-100 shadow-sm debt-card">
                        <div class="card-body">
                            <h5 class="fw-bold text-primary">{{ d.title }}</h5>

                            {% if d.creditor %}
                                <p class="mb-1 text-secondary">
                                    <i class="ti ti-user-dollar me-1"></i>
                                    <strong>Créancier :</strong> {{ d.creditor }}
                                </p>
                            {% endif %}

                            {% if d.debtor %}
                                <p class="mb-1 text-secondary">
                                    <i class="ti ti-user me-1"></i>
                                    <strong>Débiteur :</strong> {{ d.debtor }}
                                </p>
                            {% endif %}

                            <p class="mt-3 mb-1">
                                <strong>Montant initial :</strong> {{ d.original_amount }} €
                            </p>

                            <p class="text-danger fw-semibold">
                                <i class="ti ti-alert-triangle me-1"></i>
                                Reste : {{ d.remaining_amount }} €
                            </p>

                            <!-- Affichage du prochain rappel -->
                            {% if d.rappel_set.exists %}
                                {% with d.rappel_set.last as next_rappel %}
                                    {% if next_rappel.actif %}
                                        <p class="small text-info mt-2">
                                            <i class="ti ti-bell me-1"></i>
                                            Prochain rappel : {{ next_rappel.date_rappel|date:"d/m/Y H:i" }}
                                        </p>
                                    {% else %}
                                        <p class="small text-muted mt-2">
                                            <i class="ti ti-bell-off me-1"></i>
                                            Rappel désactivé
                                        </p>
                                    {% endif %}
                                {% endwith %}
                            {% else %}
                                <p class="small text-muted mt-2">
                                    <i class="ti ti-bell-plus me-1"></i>
                                    Aucun rappel configuré
                                </p>
                            {% endif %}

                            <!-- Progress Bar -->
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar" role="progressbar"
                                     style="width: {{ d.percent_paid|floatformat:0 }}%">
                                </div>
                            </div>

                            <p class="small text-muted mt-2">
                                {{ d.percent_paid|floatformat:0 }}% remboursé
                            </p>
                        </div>
                    </div>
                </a>
            </div>
        {% empty %}
            <div class="col-12 text-center py-5">
                <h4 class="text-muted">Aucune dette enregistrée.</h4>
                <a href="{% url 'detteApp:debt_add' %}" class="btn btn-primary mt-3">
                    Ajouter votre première dette
                </a>
            </div>
        {% endfor %}
    </div>

</div>

<style>
    .debt-card {
        border-radius: 14px;
        transition: all 0.2s ease-in-out;
    }
    .debt-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
</style>

{% endblock %}




