{% extends layout_path %}
{% load static %}
{% load i18n %}

{% block title %}Détails Objectif{% endblock %}

{% block content %}

<div class="container-xxl mt-5">

  <div class="row">

    <div class="col-xl-7 mx-auto">

      <!-- Main Card -->
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h4 class="mb-0">
            <i class="bx bx-target-lock"></i>
            {{ object.name }}
          </h4>

          <!-- Status badge -->
          {% if object.status == "ACTIVE" %}
            <span class="badge bg-info">Actif</span>
          {% elif object.status == "ACHIEVED" %}
            <span class="badge bg-success">Atteint</span>
          {% else %}
            <span class="badge bg-secondary">Annulé</span>
          {% endif %}
        </div>

        <div class="card-body">

          <!-- Target Amount & Current Saved -->
          <div class="mb-4">
            <h6 class="fw-bold">Montant</h6>
            <p class="mb-1">
              <strong>{{ object.total_contributed }} TND</strong>
              économisés sur
              <strong>{{ object.target_amount }} TND</strong>
            </p>

            <!-- Progress bar -->
            <div class="progress" style="height: 12px;">
              <div class="progress-bar bg-primary"
                   role="progressbar"
                   style="width: {{ object.progress_percentage }}%;"
                   aria-valuenow="{{ object.progress_percentage }}"
                   aria-valuemin="0"
                   aria-valuemax="100">
              </div>
            </div>

            <p class="mt-2 small text-muted">
              Progression : {{ object.progress_percentage }}%
            </p>
          </div>

          <!-- Target Date -->
          <div class="mb-3">
            <h6 class="fw-bold">Date cible</h6>
            <p>
              {% if object.target_date %}
                <i class="bx bx-calendar"></i>
                {{ object.target_date }}
              {% else %}
                <span class="text-muted">Aucune date définie</span>
              {% endif %}
            </p>
          </div>

          <!-- Creation Date -->
          <div class="mb-3">
            <h6 class="fw-bold">Créé le</h6>
            <p class="text-muted">
              <i class="bx bx-time"></i>
              {{ object.created_at|date:"d/m/Y à H:i" }}
            </p>
          </div>

          <!-- Buttons -->
          <div class="d-flex justify-content-between mt-4">
            <a href="{% url 'listEpargne' %}" class="btn btn-secondary">
              <i class="bx bx-arrow-back"></i> Retour
            </a>

            <div>
              <a href="{% url 'editEpargne' object.pk %}" class="btn btn-primary me-2">
                <i class="bx bx-edit-alt"></i> Modifier
              </a>

              <a href="{% url 'deleteEpargne' object.pk %}" class="btn btn-danger">
                <i class="bx bx-trash"></i> Supprimer
              </a>
            </div>
          </div>

        </div>
      </div>

      <!-- Contributions Section -->
      <div class="card mt-4">
        <div class="card-header">
          <h5 class="mb-0"><i class="bx bx-list-ul"></i> Contributions</h5>
        </div>

        <div class="card-body">

          {% if object.contributions.all %}
            <ul class="list-group">

              {% for contribution in object.contributions.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <strong>{{ contribution.amount }} TND</strong>
                    <br>
                    <small class="text-muted">
                      <i class="bx bx-time-five"></i>
                      {{ contribution.added_at|date:"d/m/Y H:i" }}
                    </small>
                  </div>
                </li>
              {% empty %}
                <li class="list-group-item text-center text-muted">
                  Aucune contribution enregistrée.
                </li>
              {% endfor %}

            </ul>
          {% endif %}

        </div>
      </div>

    </div>
  </div>

</div>

{% endblock %}